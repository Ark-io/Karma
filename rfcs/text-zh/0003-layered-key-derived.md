- title: 层次化密钥派生

## SUMMARY

利用一个根密钥，可以一层一层派生新的密钥。这种派生支持私钥派生私钥，私钥派生公钥，公钥派生公钥等功能。

## Motivation

实现两类功能，主要包括：

- 层次化派生：从根公私钥对派生出一级公私钥对，从一级公私钥对可以派生二级公私钥对。这种派生是可以任意的层次化进行，派生方式如下图：

  ![](img/layered-key-derived)

- 可以在不访问私钥的情况下，直接利用上一级公钥派生出下一级公钥。

## Detailed design

本RFC定义了两个函数，分别是利用父私钥派生出子私钥，父公钥派生出子公钥。

父私钥存在一个随机码（Random Code）用于在派生过程中引入随机数，保证

### 父私钥派生子私钥

- 父私钥 $x_p$。
- 父私钥的随机码 $r_p$。
- 子私钥ID值 $i$。
- 子私钥 $x_c$
- 子私钥的随机码 $r_c$
- 椭圆曲线生成元 $G$
- 定义HMAC函数为 $h \gets H(k,m)$，此处定义的HMAC函数输出值长度需要是私钥长度的二倍。

派生函数被表达为：$(x_i,r_i) \gets SKDH((x_p, r_p), i)$。具体的算法为：

1. 计算 $l \gets H(r_p, (x_pG || i))$
2. 将 $l$ 分为两部分，高位为 $l_R$，低位为 $l_L$。
3. 计算私钥：$x_i \gets l_R+x_p$
4. 将低位作为随机码 $r_i \gets l_L$
5. 返回私钥与随机码 $(x_i,r_i)$。

### 父公钥派生子公钥

- 父公钥 $X_p$。
- 父私钥的随机码 $r_p$。
- 子公钥ID值 $i$。
- 子公钥 $X_c$
- 子私钥的随机码 $r_c$
- 椭圆曲线生成元 $G$
- 定义HMAC函数为 $h \gets H(k,m)$，此处定义的HMAC函数输出值长度需要是私钥长度的二倍。

派生函数被表达为：$(X_i,r_i) \gets SKDH((X_p, r_p), i)$。具体的算法为：

1. 计算 $l \gets H(r_p, (X_p || i))$
2. 将 $l$ 分为两部分，高位为 $l_R$，低位为 $l_L$。
3. 计算公钥：$X_i \gets l_RG+X_p$
4. 将低位作为随机码 $r_i \gets l_L$
5. 返回私钥与随机码 $(X_i,r_i)$。